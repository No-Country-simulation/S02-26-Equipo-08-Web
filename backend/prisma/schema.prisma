generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Producto {
  id          Int      @id @default(autoincrement())
  nombre      String
  descripcion String?
  precio      Decimal
  stock       Int
  createdAt   DateTime @default(now())
}

// =============================================
// modelos del dominio
// =============================================

model usuario_estado {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
}

model usuario {
  id                  Int       @id @default(autoincrement())
  email               String    @unique @db.VarChar(60)
  password_hash       String?   @db.VarChar(500)
  id_rol              Int
  id_usuario_estado   Int       @default(1)
  fecha_alta          DateTime? @default(now()) @db.Timestamp(6)
  fecha_ultimo_login  DateTime? @db.Timestamp(6)
  intentos_login      Int       @default(0)
  fecha_deshabilitado DateTime? @db.Timestamp(6)

  @@index([id], map: "idx_usuario_id")
}

model persona {
  id             Int    @id @default(autoincrement())
  id_usuario     Int    @unique // Agregamos @unique para relaci√≥n 1 a 1
  apellido       String @db.VarChar(60)
  nombre         String @db.VarChar(60)
  identificacion String @unique @db.VarChar(45)
  direccion      String @db.VarChar(1000)
  telefono       String @unique @db.VarChar(200)
  edad           Int

  @@index([apellido, nombre], map: "idx_apellido_nombre")
}

model rol {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
}

model paciente_estado {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
}

model paciente {
  id                  Int       @id @default(autoincrement())
  nombre              String    @db.VarChar(60)
  apellido            String    @db.VarChar(60)
  identificacion      String    @db.VarChar(45)
  direccion           String?   @db.VarChar(1000)
  telefono            String?   @db.VarChar(200)
  edad                Int?
  diagnostico         String?   @db.VarChar(500)
  obra_social         String?   @db.VarChar(100)
  nro_afiliado        String?   @db.VarChar(50)
  fecha_ingreso       DateTime  @default(now()) @db.Date
  id_paciente_estado  Int       @default(1)
}

model familiar {
  id            Int @id @default(autoincrement())
  id_usuario    Int
  id_paciente   Int
  id_parentesco Int
}

model parentesco {
  id          Int     @id @default(autoincrement())
  descripcion String? @db.VarChar(50)
}

model cuidador {
  id                 Int       @id @default(autoincrement())
  id_usuario         Int
  cbu                String?   @db.VarChar(40)
  cvu                String?   @db.VarChar(40)
  alias              String?   @db.VarChar(40)
  con_documentacion  Int       @default(0) @db.SmallInt
  id_autorizado_por  Int
  fecha_autorizado   DateTime? @db.Timestamp(6)
  fecha_ingreso      DateTime  @db.Date
}

model pedido_servicio {
  id                         Int       @id @default(autoincrement())
  id_usuario                 Int
  id_paciente                Int
  fecha_del_servicio         DateTime  @db.Timestamp(6)
  hora_inicio                DateTime  @db.Time(6)
  cantidad_horas_solicitadas Float
  id_pedido_estado           Int?
  fecha_finalizado           DateTime? @db.Date
  observaciones              String?   @db.VarChar(1000)
  motivo_cancelacion         String?   @db.VarChar(500)
}

model pedido_estado {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
}

model asignacion_servico {
  id               Int       @id @default(autoincrement())
  id_cuidador      Int
  id_paciente      Int
  id_tarea         Int
  id_pedido        Int
  id_asignado_por  Int?
  fecha_asignacion DateTime? @db.Timestamp(6)
  informe_cuidado  String?   @db.VarChar(2000)
}

model tarea {
  id          Int     @id @default(autoincrement())
  descripcion String  @db.VarChar(60)
  valor_hora  Float
  moneda      String? @db.VarChar(45)
}

model guardia {
  id                 Int      @id @default(autoincrement())
  id_asignacion      Int?
  id_paciente        Int?
  id_cuidador        Int?
  id_pedido_servicio Int?
  fecha_inicio       DateTime @db.Date
  fecha_fin          DateTime @db.Date
  hora_inicio        DateTime @db.Time(6)
  hora_finalizacion  DateTime @db.Time(6)
  id_guardia_estado  Int?
  observaciones      String?
}

model guardia_estado {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
}

model pagos {
  id               Int       @id @default(autoincrement())
  id_cuidador      Int
  id_guardia       Int
  fecha_pago       DateTime? @db.Timestamp(6)
  id_pago_autorizo Int?
  cantidad_horas   DateTime? @db.Time(6)
  importe_abonado  Float?
}

model log_auditoria {
  id             Int       @id @default(autoincrement())
  fecha          DateTime? @default(now()) @db.Timestamp(6)
  id_usuario     Int
  accion         String    @db.VarChar(250)
  tabla_afectada String    @db.VarChar(250)
  valor_anterior Json?
  valor_nuevo    Json?
  ip_direccion   String?   @db.VarChar(45)
}

model disponibilidad_cuidador {
  id          Int      @id @default(autoincrement())
  id_cuidador Int
  dia_semana  Int      @db.SmallInt  // 1=Lunes, 2=Martes, 3=Miercoles, 4=Jueves, 5=Viernes, 6=Sabado, 7=Domingo
  hora_inicio DateTime @db.Time(6)
  hora_fin    DateTime @db.Time(6)

  @@unique([id_cuidador, dia_semana])
  @@index([id_cuidador])
}

model tipo_documento {
  id          Int     @id @default(autoincrement())
  descripcion String  @db.VarChar(100)
  aplica_a    String  @db.VarChar(20)
  obligatorio Boolean @default(false)
}

model documento {
  id                Int      @id @default(autoincrement())
  id_tipo_documento Int
  id_usuario        Int?
  id_paciente       Int?
  subido_por        Int
  nombre_archivo    String   @db.VarChar(255)
  nombre_guardado   String   @db.VarChar(255)
  ruta_archivo      String   @db.VarChar(500)
  mime_type         String?  @db.VarChar(100)
  tamanio_bytes     Int?
  fecha_subida      DateTime @default(now()) @db.Timestamp(6)
}
