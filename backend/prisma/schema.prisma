generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Producto {
  id          Int      @id @default(autoincrement())
  nombre      String
  descripcion String?
  precio      Decimal
  stock       Int
  createdAt   DateTime @default(now())
}

// =============================================
// modelos del dominio
// =============================================

model usuario {
  id                  Int       @id @default(autoincrement())
  email               String    @unique @db.VarChar(60)
  password_hash       String?   @db.VarChar(500)
  id_rol              Int
  estado              String    @default("PA") @db.VarChar(3)
  activo              Int       @default(1) @db.SmallInt
  fecha_alta          DateTime? @default(now()) @db.Timestamp(6)
  fecha_ultimo_login  DateTime? @db.Timestamp(6)
  intentos_login      Int       @default(0)
  fecha_deshabilitado DateTime? @db.Timestamp(6)

  // RELACIÓN: Un usuario tiene una persona
  rol                 rol       @relation(fields: [id_rol], references: [id])
  persona             persona?  // Relación 1:1 o 1:N (opcional)

  @@index([id], map: "idx_usuario_id")
}

model persona {
  id             Int    @id @default(autoincrement())
  id_usuario     Int    @unique // Agregamos @unique para relación 1 a 1
  apellido       String @db.VarChar(60)
  nombre         String @db.VarChar(60)
  identificacion String @unique @db.VarChar(45)
  direccion      String @db.VarChar(1000)
  telefono       String @unique @db.VarChar(200)
  edad           Int

  // RELACIÓN: persona pertenece a usuario
  usuario        usuario @relation(fields: [id_usuario], references: [id])

  @@index([apellido, nombre], map: "idx_apellido_nombre")
}

model rol {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
  usuarios    usuario[]
}

model paciente {
  id             Int       @id @default(autoincrement())
  nombre         String    @db.VarChar(60)
  apellido       String    @db.VarChar(60)
  identificacion String    @db.VarChar(45)
  direccion      String?   @db.VarChar(1000)
  telefono       String?   @db.VarChar(200)
  edad           Int?
  diagnostico    String?   @db.VarChar(500)
  obra_social    String?   @db.VarChar(100)
  nro_afiliado   String?   @db.VarChar(50)
  fecha_ingreso  DateTime  @default(now()) @db.Date
  activo         Int       @default(1) @db.SmallInt
}

model familiar {
  id            Int @id @default(autoincrement())
  id_usuario    Int
  id_paciente   Int
  id_parentesco Int
}

model parentesco {
  id          Int     @id @default(autoincrement())
  descripcion String? @db.VarChar(50)
}

model cuidador {
  id                 Int       @id @default(autoincrement())
  id_usuario         Int
  cbu                String?   @db.VarChar(40)
  cvu                String?   @db.VarChar(40)
  alias              String?   @db.VarChar(40)
  con_documentacion  Int       @default(0) @db.SmallInt
  id_autorizado_por  Int
  fecha_autorizado   DateTime? @db.Timestamp(6)
  fecha_ingreso      DateTime  @db.Date
}

model pedido_servicio {
  id                         Int       @id @default(autoincrement())
  id_usuario                 Int
  id_paciente                Int
  fecha_del_servicio         DateTime  @db.Timestamp(6)
  hora_inicio                DateTime  @db.Time(6)
  cantidad_horas_solicitadas Float
  id_pedido_estado           Int?
  fecha_finalizado           DateTime? @db.Date
  observaciones              String?   @db.VarChar(1000)
}

model pedido_estado {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
}

model asignacion_servico {
  id               Int       @id @default(autoincrement())
  id_cuidador      Int
  id_paciente      Int
  id_tarea         Int
  id_pedido        Int
  id_asignado_por  Int?
  fecha_asignacion DateTime? @db.Timestamp(6)
}

model tarea {
  id          Int     @id @default(autoincrement())
  descripcion String  @db.VarChar(60)
  valor_hora  Float
  moneda      String? @db.VarChar(45)
}

model guardia {
  id                 Int      @id @default(autoincrement())
  id_asignacion      Int?
  id_paciente        Int?
  id_cuidador        Int?
  id_pedido_servicio Int?
  fecha_inicio       DateTime @db.Date
  fecha_fin          DateTime @db.Date
  hora_inicio        DateTime @db.Time(6)
  hora_finalizacion  DateTime @db.Time(6)
  id_guardia_estado  Int?
  observaciones      String?
}

model guardia_estado {
  id          Int    @id @default(autoincrement())
  descripcion String @db.VarChar(45)
}

model pagos {
  id               Int       @id @default(autoincrement())
  id_cuidador      Int
  id_guardia       Int
  fecha_pago       DateTime? @db.Timestamp(6)
  id_pago_autorizo Int?
  cantidad_horas   DateTime? @db.Time(6)
  importe_abonado  Float?
}

model log_auditoria {
  id             Int       @id @default(autoincrement())
  fecha          DateTime? @default(now()) @db.Timestamp(6)
  id_usuario     Int
  accion         String    @db.VarChar(250)
  tabla_afectada String    @db.VarChar(250)
  valor_anterior Json?
  valor_nuevo    Json?
  ip_direccion   String?   @db.VarChar(45)
}
